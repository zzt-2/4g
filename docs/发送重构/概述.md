# 发送功能重构概述

## 当前问题分析

### 核心架构问题

- **任务类型过度细分**：单帧/多帧与定时/触发/顺序的组合导致了6种不同的任务类型和对应的处理函数
- **代码重复严重**：相似的发送逻辑分散在多个函数中，维护成本高
- **配置管理混乱**：不同类型的任务配置分散管理，缺乏统一接口
- **API使用不一致**：targetPath的使用在不同发送方式中不统一

### 具体技术问题

- **定时发送配置失效**：用户配置的时间间隔和重复次数没有正确应用
- **实例间延时未使用**：在定时发送场景下，配置的实例间延时被忽略
- **单帧多帧逻辑冗余**：本质相同的发送逻辑被人为分为单帧和多帧两套实现
- **错误处理不统一**：不同类型任务的错误处理方式不一致

### 代码质量问题

- **文件冗余**：存在功能重叠的组件和工具文件
- **类型定义分散**：相关类型定义分布在多个文件中
- **Store职责不清**：多个Store之间存在职责重叠

## 重构目标

### 简化架构设计

- **统一发送核心**：所有发送操作使用统一的核心逻辑
- **简化任务分类**：按执行策略而非实例数量分类
- **统一配置管理**：建立统一的配置接口和管理机制

### 提升代码质量

- **消除重复代码**：通过抽象和复用减少代码重复
- **统一API调用**：确保所有发送方式使用一致的API
- **优化错误处理**：建立统一的错误处理和状态管理机制

### 清理冗余内容

- **删除多余文件**：移除功能重叠和不再使用的文件
- **整合类型定义**：合并分散的类型定义
- **精简组件结构**：减少不必要的组件层级

## 重构方向

### 核心抽象层设计

1. **统一发送引擎**：抽象出通用的帧发送逻辑
2. **策略模式应用**：将不同的执行策略（立即/定时/触发）作为策略实现
3. **配置标准化**：建立统一的任务配置标准

### 组件架构重构

1. **合并相似组件**：整合功能重叠的UI组件
2. **简化对话框结构**：减少配置对话框的复杂度
3. **统一状态管理**：优化Store结构，明确职责边界

### API接口统一

1. **标准化发送接口**：确保所有发送操作使用相同的接口签名
2. **统一目标管理**：建立一致的连接目标处理机制
3. **规范化配置格式**：统一配置文件的结构和验证

## 预期收益

### 开发效率提升

- **代码维护简化**：减少50%以上的重复代码
- **功能扩展便利**：新增发送策略只需实现策略接口
- **错误定位精准**：统一的错误处理便于问题诊断

### 用户体验改善

- **配置流程简化**：统一的配置界面降低学习成本
- **功能稳定性提升**：减少因代码重复导致的不一致问题
- **性能优化**：消除冗余组件和逻辑提升响应速度

### 代码质量提升

- **架构清晰**：职责明确的模块化设计
- **可测试性增强**：独立的策略实现便于单元测试
- **扩展性提升**：插件化的策略设计支持功能扩展

## 实施优先级

### 第一阶段：核心重构

1. 统一发送引擎设计
2. 策略模式实现
3. API接口标准化

### 第二阶段：组件整合

1. UI组件合并重构
2. 配置管理统一
3. Store结构优化

### 第三阶段：清理优化

1. 冗余代码删除
2. 文件结构整理
3. 类型定义合并

## 风险评估

### 技术风险

- **重构范围较大**：需要修改多个核心文件
- **测试复杂度**：需要全面测试各种发送场景
- **兼容性考虑**：可能影响现有的使用方式

### 缓解措施

- **分阶段实施**：按优先级逐步重构，降低单次变更风险
- **充分测试**：建立完整的测试用例覆盖所有场景
- **文档完善**：提供详细的迁移指南和API文档
